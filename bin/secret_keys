#!/usr/bin/env ruby

require_relative "../lib/secret_keys/cli"

# Load enironment variables from .env file in current working directory if available.
if File.exist?(File.expand_path(".env"))
  begin
    require 'dotenv/load'
  rescue LoadError
    # Ignore; dotenv gem not available.
  end
end

COMMANDS = {
  "encrypt" => SecretKeys::CLI::Encrypt,
  "decrypt" => SecretKeys::CLI::Decrypt,
  "read" => SecretKeys::CLI::Read,
  "edit" => SecretKeys::CLI::Edit
}.freeze

argv = ARGV.dup
action = argv.shift
command_class = COMMANDS[action]
unless command_class
  command = SecretKeys::CLI::Base.new(argv)
  STEDRR.puts "Unknow action #{action.inspect}; must be one of #{COMMANDS.keys.join(', ')}"
  exit 1
end

command = command_class.new(argv)
command.run!
